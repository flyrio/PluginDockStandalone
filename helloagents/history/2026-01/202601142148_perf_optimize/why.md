# 方案名称: 启用即掉帧的性能优化

## 需求背景
有用户反馈：只要插件启动（即加载启用），就会出现明显帧数下降；该问题与 Dock/配置窗口是否打开无关，即使仅启用悬浮窗或完全不打开任何界面也会掉帧。

## 用户画像
- **用户类型:** FFXIV Dalamud 插件使用者
- **用户目标:** 启用插件后保持正常帧率；Dock/窗口隐藏等功能不应引入持续高占用
- **用户能力:** 熟悉基础插件配置与常见排查（开关窗口、启用/禁用插件）

## 需求范围
1. 优化 `UiBuilder.Draw` 常驻逻辑，避免在无必要时执行高开销操作
2. 优化 Dock 悬浮窗渲染路径，减少每帧重复枚举/排序/构建数据结构
3. 优化图标加载路径的文件 IO 热点，减少每帧 `File.Exists` 等重复检查

## 验收标准
- **性能:** 插件启用且不打开任何窗口时，不再出现明显掉帧（CPU 占用显著下降）
- **性能:** Dock 展开时仍保持流畅，图标与条目渲染无明显卡顿
- **功能:** 窗口隐藏器依旧能可靠隐藏目标窗口；Dock/配置/图标库功能行为不变
- **稳定性:** 无新增异常日志；无明显闪烁/窗口“漏出”问题

## 风险与边界

### 风险: 隐藏器刷新策略变更导致闪烁
**描述:** 若降低隐藏器执行频率，可能出现目标窗口短暂显示。
**规避:** 优先做“无感知”的热路径降本（减少字符串/IO/重复枚举），不引入可见闪烁风险。

### 风险: 插件列表缓存导致信息更新延迟
**描述:** Dock 渲染依赖已加载插件列表，缓存可能导致插件启用/禁用后的显示延迟。
**规避:** 采用短周期刷新（秒级）+必要时强制刷新，保证用户体验。

## 关键假设
- 掉帧主因来自每帧执行的常驻逻辑（即使窗口未打开仍会运行）
- 用户环境中插件数量较多，重复枚举/排序与文件 IO 对帧率影响显著

